# AMM Configuration Data Model

## Overview
In order to simulate a scenario, modules capable of performing the desired simulation must be present and properly
 configured.
In order for a given Scenario definition to be simulated on a variety of hardware,
 common definitions of module functionality, requirements and configuration must be established.
This document outlines the format for these definitions.

## Capabilities
Capabilities are the logical Unit of Functionality for a given module.
Each distinct function of a module should be broken into a separate Capability where possible.
This not only clearly defines what all a module is capable of,
 but also enables functionality to be configured and monitored independently,
 providing better resilience for modules designed and built this way. 
Module technical definition and configuration is broken down by Capability,
 and modules report their status on a per-Capability basis.

When possible, manufacturers shall use existing Capability descriptions to denote functionality and configuration
 within their modules.
This greatly enhances interoperability and enables re-use of scenario definitions.

Definitions for capabilities are in the [Capability Types Glossary](glossaries/Capability).

## AMM Standard Version
Derived from [Semantic Versioning](https://semver.org), AMM uses the version numbering scheme: MAJOR.MINOR.PATCH

Version numbers are incremented based on the following:
* MAJOR Version: Changes to IDL / XML Schema, breaking changes to Glossary definitions
* MINOR Version: New entries added to Glossaries
* PATCH Version: Non-breaking changes to Glossary definitions, bug fixes

Development / beta versions may break this, but will have a Major version of `0`. Once `v1.0.0` is published,
 this will be in effect.

## Operational Description
All Modules musts publish their Capabilities using the `OperationalDescription` Topic.
The Topic consists of several metadata fields about the module, along with the `capabilities_schema` field,
 which is an XML document describing the Capabilities and configuration options for the Module.

The Module Manager software (or other software performing equivalent core functionality) shall  subscribe to this
 topic and record the associations between the the `module_id` value and the `manufacturer` and `model` values.
The combination of `manufacturer` & `model` is used to associate configurations in the Scenario with connected Modules.
Additionally, the `configuration_version` field is compared to ensure compatibility.
 
`OperationDescription` Topic fields:
* `name`
* `description`
* `manufacturer`
* `model`
* `serial_number`
* `module_id`
* `module_version`
* `configuration_version`
* `AMM_version`
* `capabilities_schema`

#### `name` Field
A human friendly short identifier for the Module. Used for user interface displays.

#### `description` Field
A short paragraph that describes the overall Module. Used for user interface displays.

#### `manufacturer` Field
The name of the manufacturer. This shall be consistent across Modules from the same manufacturer.

#### `model` Field
The name of the model of Module. This shall be unique per manufacturer.

#### `serial_number` Field
An identifier unique to Module hardware. May be empty for purely software Modules.

#### `module_id` Field
Generated by the Module and shall be unique per module instance. Used to uniquely identify Module in AMM system.

#### `module_version` Field
The version of the Module. Should include both hardware and software versions when applicable.

#### `configuration_version` Field
The version number of the Module's configuration structure.This version is updated by the manufacturer in accordance
 with the principals of [Semantic Versioning](https://semver.org). 
This value is used by the Module Manager (or equivalent) to determine whether a configuration provided by a Scenario
 is compatible with a connected Module of the same `manufacturer` and `model`.

Modules shall be compatible with all configurations that share a MAJOR version number.
Any additional features from newer MINOR version changes should be able to be ignored,
 and any missing values from older MINOR versions should have reasonable defaults.

#### `AMM_version` Field
The latest version of the AMM standard Module is compatible with.

#### `capabilities_schema` Field
This field shall comply with the [XML Schema](https://www.w3.org/XML/Schema) (version 1.1) defined by
 [CapabilitiesSchema.xsd](schema/CapabilitiesSchema.xsd).

This field shall have XML version & encoding of `<?xml version="1.0" encoding="UTF-8"?>`.

### Capabilities Schema Description
Per the schema, the root element shall be `<CapabilitiesSchema>`.

If powered via PoE `<BaselinePoEPower>` must be the first child element.
`BaselinePoEPower` tag always has only two attributes, `nominal` and `units`.
Together, their value defines how much power the module requires, before any additional capability power requirements.
This is usually the power draw of the embedded CPU.

Every module must define at least one Capability.
`Capability` tag `type`s and additional attributes shall be defined per the
 [Capabilities Glossary](glossaries/Capability).
`Capability` tags have exactly four (ordered) child elements:
```
<Subscriptions></Subscriptions>
<Publications></Publications>
<Assessments></Assessments>
<Resources></Resources>
```

The `Subscriptions` and `Publications` tags contain only child elements defining what topics a module subscribes and
 publishes to.
Child element tag names are identical to the topic names defined by [AMM.idl](schema/AMM.idl).
Element attributes are defined in the [XML Schema Definition](schema/CapabilitiesSchema.xsd).
All child elements of the `Subscriptions` and `Publications` tags take an optional `match` attribute,
 which indicates whether a matched subscriber or publisher is `optional` (default) or `required` for proper module
 operation.
A `required` match indicates that the module capability will not achieve `OPERATIONAL` state without the appropriately
 matching publisher or subscriber.
 
The `Assessments` tag contains only child elements defining Event Records (including Omitted Events) that the module may
 assess.
While modules are not required to assess any Events, assessment is a core component of high-quality education, and,
 thus, a core feature of the AMM standard.
As such, module manufacturers should strive to include assessments as a core component of their modules.

The `Resources` tag contains only two types of elements `Requirement` and `Supply`,
 though each may be repeated to indicate which resources are being supplied or consumed.
The element definitions are:
```
<Requirement
  type=”Power, Blood Simulant, Clear Liquid, or Compressed Air”
  nominal=”Rate of fluid draw or power usage during normal operation”
  peak=”Peak fluid draw or power usage, optional attribute”
  unit=”Volume per time unit”
/>
<Supply
  type=”Power, Blood Simulant, Clear Liquid, or Compressed Air”
  capacity=”Fluid supply capacity”
  unit=”Volume per time unit”
/>
```

Finally, any & all configuration for a module is contained in a final (optional) `<Configuration>` tag.
The Configuration tag should either contain binary data (wrapped in either a `<hex>` or `<base64>` tag),
 or contain an XML Schema definition for the available configuration values, if feasible.
This is to enable future software to prompt end users for configuration values.

A contrived example of a Capabilities Schema document for an IV arm is included in this repository:
[ExampleCapabilitiesSchema.xml](ExampleCapabilitiesSchema.xml).

## Module Configuration
Modules shall publish their current configuration to the `ModuleConfiguration` Topic upon successful connection to an
 AMM system.
The Module Manager (or equivalent) software shall subscribe to this topic and 

First published by Module at boot, then updated by Module Manager with configuration when Scenario is loaded.
May also be updated later by Module in response to a `SAVE` control.

`ModuleConfiguration` Topic fields:
`name`
Module ID (Module-generated UUID, DDS Topic Key)
Educational Encounter (UUID, assigned by Module Manager when config is loaded)
Timestamp (UTC Epoch, millisecond resolution) – Time of last update
IP Address
Capabilities Configuration (XML)

        string name;
        @Key UUID module_id;
        UUID educational_encounter;
        unsigned long long timestamp;
        octet ip_address[4];
        string capabilities_configuration;
 
